---
import { siteConfig } from "../config";
const hasProjects = siteConfig.projects && siteConfig.projects.length > 0;
const projectsJson = JSON.stringify(siteConfig.projects);
---

{hasProjects && (
  <section
    id="projects"
    class="p-8 sm:p-12 md:p-16 lg:p-24"
    data-projects={projectsJson}
  >
    <div>
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-16 items-start">
        <div class="lg:col-span-4">
          <h2 class="text-3xl sm:text-4xl md:text-5xl xl:text-7xl font-bold text-gray-900">
            Projects
          </h2>
          <div
            class="w-[75px] h-[5px] mt-2 rounded-full"
            style={`background-color: ${siteConfig.accentColor}`}
          />
        </div>

        <div class="lg:col-span-8">
          <div class="space-y-8">
            {siteConfig.projects.map((project, index) => (
              <div
                class="group relative cursor-pointer project-card block p-4 sm:p-6 md:p-8 bg-gray-50 rounded-xl sm:rounded-2xl border border-gray-200 transition-all duration-300 hover:bg-white hover:shadow-xl hover:border-gray-300 hover:-translate-y-1"
                data-index={index}
              >
                <div class="space-y-4">
                  <div class="absolute top-4 right-4 sm:top-6 sm:right-6 md:top-8 md:right-8 w-10 h-10 sm:w-11 sm:h-11 md:w-12 md:h-12 flex items-center justify-center bg-gray-900 rounded-full text-white transition-all duration-300 group-hover:bg-gray-700">
                    <svg
                      class="w-4 h-4 sm:w-4.5 sm:h-4.5 md:w-5 md:h-5 transition-transform duration-300 group-hover:translate-x-0.5 group-hover:-translate-y-0.5"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M7 17L17 7M17 7H7M17 7V17"
                      />
                    </svg>
                  </div>
                  <div>
                    <span
                      class="text-sm font-mono"
                      style={`color: ${siteConfig.accentColor}`}
                    >
                      {(index + 1).toString().padStart(2, '0')}
                    </span>
                    <h3 class="text-xl sm:text-2xl font-bold text-gray-900 mt-1">
                      {project.name}
                    </h3>
                  </div>

                  {/* <p class="text-base sm:text-lg text-gray-600 leading-relaxed text-justify">
                    {project.description}
                  </p> */}

                  {project.skills && project.skills.length > 0 && (
                    <div class="flex flex-wrap gap-1.5 sm:gap-2 pt-2">
                      {project.skills.map((skill) => (
                        <span
                          class="px-2.5 sm:px-3 py-1 sm:py-1.5 bg-gray-900 text-white rounded-md sm:rounded-lg text-xs sm:text-sm font-medium transition-all duration-300 group-hover:bg-gray-800"
                        >
                          {skill}
                        </span>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>

    {/* <!-- Modal dengan Carousel --> */}
    <div
      id="projectModal"
      class="fixed inset-0 bg-black bg-opacity-0 pointer-events-none opacity-0 z-50 flex items-center justify-center transition-all duration-300"
    >
      <div
        class="bg-white rounded-2xl max-w-4xl w-[95%] max-h-[90vh] p-6 sm:p-8 relative shadow-2xl transform scale-95 transition-all duration-300 flex flex-col"
        id="modalContent"
      >
        <button
          id="closeModal"
          class="absolute top-3 right-4 text-gray-500 hover:text-gray-800 text-2xl z-10 bg-white rounded-full w-8 h-8 flex items-center justify-center cursor-pointer"
        >
          &times;
        </button>
        
        {/* Carousel Container dengan overflow hidden */}
        <div id="carouselContainer" class="mb-6 relative flex-shrink-0 rounded-xl">
          <div id="carouselTrack" class="flex transition-transform duration-300 ease-in-out h-full"></div>
          
          {/* Navigation Buttons */}
          <button 
            id="carouselPrev" 
            class="absolute left-2 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white rounded-full w-8 h-8 flex items-center justify-center transition-all duration-200 opacity-0 pointer-events-none z-20"
          >
            ‹
          </button>
          <button 
            id="carouselNext" 
            class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white rounded-full w-8 h-8 flex items-center justify-center transition-all duration-200 opacity-0 pointer-events-none z-20"
          >
            ›
          </button>
          
          {/* Dots Indicator */}
          <div id="carouselDots" class="flex justify-center mt-4 space-x-2 absolute bottom-4 left-0 right-0"></div>
        </div>

        {/* Content Area - Scrollable */}
        <div class="flex-1 flex flex-col min-h-0">
          <h2
            id="modalTitle"
            class="text-2xl sm:text-3xl font-bold mb-4 flex-shrink-0"
            style={`color: ${siteConfig.accentColor}`}
          ></h2>
          
          {/* Scrollable Description */}
          <div class="flex-1 min-h-0">
            <p id="modalDesc" class="text-gray-700 leading-relaxed mb-4 text-justify"></p>
          </div>
          
          {/* Skills - Fixed at Bottom */}
          <div id="modalSkills" class="flex flex-wrap gap-2 pt-4 flex-shrink-0 border-t border-gray-200 mt-4"></div>
        </div>
      </div>
    </div>
  </section>
)}

<!-- ✅ Client-side script dengan Carousel -->
<script>
  const section = document.getElementById("projects");
  const projects = JSON.parse(section.dataset.projects);

  const modal = document.getElementById("projectModal");
  const modalContent = document.getElementById("modalContent");
  const titleEl = document.getElementById("modalTitle");
  const descEl = document.getElementById("modalDesc");
  const skillsEl = document.getElementById("modalSkills");
  const closeBtn = document.getElementById("closeModal");
  
  // Carousel elements
  const carouselContainer = document.getElementById("carouselContainer");
  const carouselTrack = document.getElementById("carouselTrack");
  const carouselPrev = document.getElementById("carouselPrev");
  const carouselNext = document.getElementById("carouselNext");
  const carouselDots = document.getElementById("carouselDots");

  let currentSlide = 0;
  let totalSlides = 0;

  function initCarousel(images) {
    carouselTrack.innerHTML = '';
    carouselDots.innerHTML = '';
    currentSlide = 0;

    // Jika tidak ada gambar, gunakan placeholder
    if (images.length === 0) {
      images = ['https://placehold.co/600x400?text=Confidential'];
    }
    
    totalSlides = images.length;
    carouselContainer.style.display = 'block';

    // Set height untuk carousel container
    carouselContainer.classList.add('h-64', 'sm:h-80', 'md:h-96');
    
    // Set width carousel track berdasarkan jumlah slide
    carouselTrack.style.width = `${totalSlides * 100}%`;
    
    // Create slides
    images.forEach((image, index) => {
      const slide = document.createElement('div');
      slide.className = 'w-full h-full flex-shrink-0';
      slide.style.width = `${100 / totalSlides}%`; // Penting: set width setiap slide
      slide.innerHTML = `
        <img 
          src="${image}" 
          alt="Project image ${index + 1}" 
          class="w-full h-full object-cover"
        />
      `;
      carouselTrack.appendChild(slide);
    });

    // Create dots - hanya jika lebih dari 1 slide
    if (images.length > 1) {
      images.forEach((_, index) => {
        const dot = document.createElement('button');
        dot.className = `w-3 h-3 rounded-full transition-all duration-200 ${
          index === currentSlide ? 'bg-gray-800 scale-110' : 'bg-gray-300'
        }`;
        dot.addEventListener('click', () => goToSlide(index));
        carouselDots.appendChild(dot);
      });

      // Show navigation buttons
      carouselPrev.classList.remove('opacity-0', 'pointer-events-none');
      carouselNext.classList.remove('opacity-0', 'pointer-events-none');
    } else {
      // Hide navigation jika hanya 1 gambar
      carouselPrev.classList.add('opacity-0', 'pointer-events-none');
      carouselNext.classList.add('opacity-0', 'pointer-events-none');
      carouselDots.innerHTML = '';
    }

    updateCarousel();
  }

  function updateCarousel() {
    const slideWidth = 100 / totalSlides;
    carouselTrack.style.transform = `translateX(-${currentSlide * slideWidth}%)`;
    
    // Update dots
    const dots = carouselDots.querySelectorAll('button');
    dots.forEach((dot, index) => {
      dot.className = `w-3 h-3 rounded-full transition-all duration-200 ${
        index === currentSlide ? 'bg-gray-800 scale-110' : 'bg-gray-300'
      }`;
    });

    // Update navigation buttons
    // carouselPrev.style.opacity = currentSlide === 0 ? '0.5' : '1';
    // carouselNext.style.opacity = currentSlide === totalSlides - 1 ? '0.5' : '1';
  }

  function nextSlide() {
    if (currentSlide < totalSlides - 1) {
      currentSlide++;
      updateCarousel();
    }
  }

  function prevSlide() {
    if (currentSlide > 0) {
      currentSlide--;
      updateCarousel();
    }
  }

  // Event listeners for carousel
  carouselPrev.addEventListener('click', prevSlide);
  carouselNext.addEventListener('click', nextSlide);

  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (modal.classList.contains('opacity-100')) {
      if (e.key === 'ArrowLeft') prevSlide();
      if (e.key === 'ArrowRight') nextSlide();
    }
  });

  function openModal(project) {
    // Isi konten
    titleEl.textContent = project.name;
    descEl.textContent = project.description;
    skillsEl.innerHTML = "";
    
    if (project.skills && project.skills.length > 0) {
      project.skills.forEach((skill) => {
        const span = document.createElement("span");
        span.className = "px-3 py-1 bg-gray-900 text-white rounded-lg text-sm font-medium";
        span.textContent = skill;
        skillsEl.appendChild(span);
      });
    }

    // Initialize carousel dengan gambar dari project
    // Jika tidak ada images, akan otomatis pakai placeholder
    const images = project.images || [];
    initCarousel(images);

    // Tampilkan modal dengan animasi
    modal.classList.remove("pointer-events-none", "opacity-0");
    modal.classList.add("bg-opacity-60", "opacity-100");
    modalContent.classList.remove("scale-95");
    modalContent.classList.add("scale-100");
  }

  function closeModalSmooth() {
    // animasi keluar
    modal.classList.add("opacity-0");
    modal.classList.remove("opacity-100", "bg-opacity-60");
    modalContent.classList.add("scale-95");
    modalContent.classList.remove("scale-100");

    // tunggu animasi selesai baru disembunyikan interaksinya
    setTimeout(() => {
      modal.classList.add("pointer-events-none");
    }, 300);
  }

  document.querySelectorAll(".project-card").forEach((card) => {
    card.addEventListener("click", () => {
      const index = parseInt(card.dataset.index);
      const project = projects[index];
      openModal(project);
    });
  });

  closeBtn.addEventListener("click", closeModalSmooth);
  modal.addEventListener("click", (e) => {
    if (e.target === modal) closeModalSmooth();
  });
</script>